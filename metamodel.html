<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Metamodel | Post-Labor Economics</title>
  <link rel="icon" type="image/svg+xml" href="ple-logo.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,300;9..144,400;9..144,600;9..144,700&family=DM+Mono:wght@400;500&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
  <style>
    /* ─── RESET & BASE ────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --hz:  #1B4D3E;
      --hz2: #2D6A54;
      --hz3: #143B30;
      --dn:  #F4A261;
      --dn2: #F7BD8A;
      --mid: #0D1B2A;
      --mid2: #1B2D42;
      --sge: #4A7C6F;
      --crm: #FAF8F5;
      --pch: #F5F3EF;
      --mst: #E9ECEF;
      --stn: #6C757D;
      --mono: 'DM Mono', 'JetBrains Mono', monospace;
      --serif: 'Fraunces', Georgia, serif;
      --sans: 'Inter', system-ui, sans-serif;
      --panel-w: 400px;
    }

    html { font-size: 15px; }

    body {
      font-family: var(--sans);
      background: var(--crm);
      color: var(--mid);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ─── HEADER ──────────────────────────────────────────── */
    .header {
      background: var(--mid);
      color: white;
      padding: 0 1.5rem;
      height: 56px;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      text-decoration: none;
      flex-shrink: 0;
    }

    .logo-symbol {
      font-family: var(--serif);
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--dn);
    }

    .logo-text {
      font-size: 0.8125rem;
      font-weight: 500;
      color: rgba(255,255,255,0.65);
      display: none;
    }

    @media (min-width: 640px) { .logo-text { display: block; } }

    .nav-menu {
      display: flex;
      gap: 0.125rem;
      flex: 1;
    }

    .nav-menu a {
      color: rgba(255,255,255,0.55);
      text-decoration: none;
      font-size: 0.8rem;
      font-weight: 500;
      padding: 0.375rem 0.625rem;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-menu a:hover { color: white; background: rgba(255,255,255,0.07); }
    .nav-menu a.active { color: var(--dn); }

    .header-right {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* ─── PAGE LAYOUT ─────────────────────────────────────── */
    .page-wrap {
      display: flex;
      flex: 1;
      overflow: hidden;
      height: calc(100vh - 56px);
    }

    /* ─── LEFT SIDEBAR — NAVIGATOR ────────────────────────── */
    .nav-sidebar {
      width: 260px;
      flex-shrink: 0;
      background: white;
      border-right: 1px solid var(--mst);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .nav-sidebar-header {
      padding: 1rem 1rem 0.75rem;
      border-bottom: 1px solid var(--mst);
    }

    .nav-sidebar-title {
      font-family: var(--serif);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--hz);
      margin-bottom: 0.625rem;
    }

    .nav-search {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--pch);
      border: 1px solid var(--mst);
      border-radius: 6px;
      padding: 0.375rem 0.625rem;
    }

    .nav-search input {
      border: none;
      background: transparent;
      font-size: 0.8rem;
      color: var(--mid);
      width: 100%;
      outline: none;
    }

    .nav-search svg { color: var(--stn); width: 14px; height: 14px; flex-shrink: 0; }

    .nav-sections {
      overflow-y: auto;
      flex: 1;
    }

    .nav-section {
      border-bottom: 1px solid var(--mst);
    }

    .nav-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.625rem 1rem;
      cursor: pointer;
      user-select: none;
      background: var(--pch);
      gap: 0.5rem;
    }

    .nav-section-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: var(--stn);
    }

    .nav-section-count {
      font-size: 0.68rem;
      background: var(--mst);
      color: var(--stn);
      padding: 0.1rem 0.4rem;
      border-radius: 10px;
      font-weight: 600;
    }

    .nav-section-chevron { width: 14px; height: 14px; color: var(--stn); transition: transform 0.2s; }
    .nav-section.open .nav-section-chevron { transform: rotate(90deg); }

    .nav-items {
      display: none;
      padding: 0.25rem 0;
    }

    .nav-section.open .nav-items { display: block; }

    .nav-item {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
      transition: background 0.15s;
      border-left: 2px solid transparent;
    }

    .nav-item:hover { background: var(--pch); }

    .nav-item.active {
      background: rgba(27,77,62,0.06);
      border-left-color: var(--hz);
    }

    .nav-item-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-top: 4px;
      flex-shrink: 0;
    }

    .nav-item-title {
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--mid);
      line-height: 1.35;
    }

    .nav-item-meta {
      font-size: 0.7rem;
      color: var(--stn);
      margin-top: 0.1rem;
    }

    /* ─── MAIN CONTENT AREA ───────────────────────────────── */
    .main-area {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    /* ─── OVERVIEW PANEL (default state) ──────────────────── */
    .overview-panel {
      padding: 2rem;
      max-width: 900px;
    }

    .overview-hero {
      background: linear-gradient(135deg, var(--hz) 0%, #1a3d2f 60%, var(--mid) 100%);
      border-radius: 1rem;
      padding: 2rem;
      color: white;
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
    }

    .overview-hero::after {
      content: 'M';
      position: absolute;
      bottom: -2rem;
      right: 1rem;
      font-family: var(--serif);
      font-size: 12rem;
      font-weight: 700;
      color: rgba(255,255,255,0.04);
      pointer-events: none;
      line-height: 1;
    }

    .overview-hero h1 {
      font-family: var(--serif);
      font-size: 1.75rem;
      font-weight: 600;
      color: white;
      margin-bottom: 0.5rem;
    }

    .overview-hero p {
      color: rgba(255,255,255,0.7);
      font-size: 0.9rem;
      line-height: 1.6;
      max-width: 560px;
      margin-bottom: 1.5rem;
    }

    .hero-stats {
      display: flex;
      gap: 1.75rem;
      flex-wrap: wrap;
    }

    .hero-stat-val { font-size: 1.5rem; font-weight: 700; color: var(--dn); }
    .hero-stat-lbl { font-size: 0.7rem; color: rgba(255,255,255,0.45); text-transform: uppercase; letter-spacing: 0.06em; }

    /* ─── LAYER DIAGRAM ───────────────────────────────────── */
    .metamodel-layers {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 700px) { .metamodel-layers { grid-template-columns: 1fr; } }

    .layer-card {
      background: white;
      border: 1px solid var(--mst);
      border-radius: 0.75rem;
      padding: 1.25rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .layer-card:hover {
      border-color: var(--hz);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(27,77,62,0.1);
    }

    .layer-card-num {
      font-family: var(--mono);
      font-size: 0.7rem;
      font-weight: 500;
      color: var(--stn);
      margin-bottom: 0.375rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .layer-card-title {
      font-family: var(--serif);
      font-size: 1rem;
      font-weight: 600;
      color: var(--hz);
      margin-bottom: 0.375rem;
    }

    .layer-card-desc {
      font-size: 0.78rem;
      color: var(--stn);
      line-height: 1.5;
      margin-bottom: 0.875rem;
    }

    .layer-card-types {
      display: flex;
      flex-wrap: wrap;
      gap: 0.375rem;
    }

    .type-chip {
      font-size: 0.68rem;
      font-family: var(--mono);
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      border: 1px solid currentColor;
      opacity: 0.75;
    }

    /* ─── FRAMEWORKS GRID ─────────────────────────────────── */
    .section-title {
      font-family: var(--serif);
      font-size: 1.15rem;
      font-weight: 600;
      color: var(--hz);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .fw-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 0.875rem;
      margin-bottom: 2rem;
    }

    .fw-card {
      background: white;
      border: 1px solid var(--mst);
      border-radius: 0.75rem;
      padding: 1.125rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .fw-card:hover {
      border-color: var(--hz2);
      box-shadow: 0 4px 16px rgba(27,77,62,0.08);
    }

    .fw-card-code {
      font-family: var(--mono);
      font-size: 0.68rem;
      color: var(--stn);
      margin-bottom: 0.375rem;
      letter-spacing: 0.04em;
    }

    .fw-card-title {
      font-family: var(--serif);
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--hz);
      margin-bottom: 0.375rem;
    }

    .fw-card-desc {
      font-size: 0.75rem;
      color: var(--stn);
      line-height: 1.5;
    }

    .fw-card-footer {
      margin-top: 0.75rem;
      padding-top: 0.625rem;
      border-top: 1px solid var(--mst);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .scope-badge {
      font-size: 0.66rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.15rem 0.45rem;
      border-radius: 4px;
    }

    .scope-normative    { background: rgba(27,77,62,0.1);    color: var(--hz); }
    .scope-analytical   { background: rgba(107,154,196,0.15); color: #2a6b9e; }
    .scope-descriptive  { background: rgba(74,124,111,0.12);  color: var(--sge); }
    .scope-evaluative   { background: rgba(244,162,97,0.15);  color: #c4722a; }

    .completeness-dot {
      width: 8px; height: 8px; border-radius: 50%;
      display: inline-block;
    }

    .comp-complete   { background: #2D6A4F; }
    .comp-draft      { background: var(--dn); }
    .comp-outline    { background: var(--stn); }
    .comp-validated  { background: #7FC8A9; }

    /* ─── DETAIL PANEL ────────────────────────────────────── */
    .detail-panel {
      flex: 1;
      padding: 2rem;
      max-width: 820px;
      display: none;
    }

    .detail-panel.visible { display: block; }

    .detail-back {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      color: var(--stn);
      font-size: 0.8rem;
      cursor: pointer;
      margin-bottom: 1.5rem;
      padding: 0.25rem 0;
      border-bottom: 1px solid transparent;
      transition: all 0.15s;
    }

    .detail-back:hover { color: var(--hz); border-bottom-color: var(--hz); }

    .detail-header {
      margin-bottom: 1.75rem;
    }

    .detail-code {
      font-family: var(--mono);
      font-size: 0.72rem;
      color: var(--stn);
      margin-bottom: 0.375rem;
      letter-spacing: 0.04em;
    }

    .detail-title {
      font-family: var(--serif);
      font-size: 1.75rem;
      font-weight: 600;
      color: var(--hz);
      margin-bottom: 0.75rem;
      line-height: 1.2;
    }

    .detail-badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .detail-badge {
      font-size: 0.7rem;
      font-weight: 600;
      padding: 0.2rem 0.6rem;
      border-radius: 100px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .badge-type-phenomenon  { background: rgba(231,111,81,0.12); color: #8B2500; }
    .badge-type-mechanism   { background: rgba(27,77,62,0.1);    color: var(--hz); }
    .badge-type-proposal    { background: rgba(107,154,196,0.15); color: #2a6b9e; }
    .badge-type-critique    { background: rgba(244,162,97,0.2);  color: #a05a15; }
    .badge-type-synthesis   { background: rgba(74,124,111,0.15);  color: #2a5f53; }

    .badge-mat-canonical   { border: 1.5px solid var(--hz); color: var(--hz); background: transparent; }
    .badge-mat-established { border: 1.5px solid var(--sge); color: var(--sge); background: transparent; }
    .badge-mat-developing  { border: 1.5px solid var(--stn); color: var(--stn); background: transparent; }
    .badge-mat-embryonic   { border: 1.5px dashed var(--stn); color: var(--stn); background: transparent; }

    .badge-conf-consensus  { background: rgba(45,106,79,0.1); color: #1d4b35; }
    .badge-conf-supported  { background: rgba(107,154,196,0.12); color: #2a5d80; }
    .badge-conf-contested  { background: rgba(244,162,97,0.15); color: #8a4b0a; }
    .badge-conf-speculative { background: rgba(108,117,125,0.1); color: var(--stn); }

    .detail-summary {
      font-size: 1rem;
      line-height: 1.7;
      color: var(--mid2);
      margin-bottom: 2rem;
      padding-left: 1rem;
      border-left: 3px solid var(--dn);
    }

    /* ─── DETAIL SECTIONS ─────────────────────────────────── */
    .detail-section {
      margin-bottom: 1.75rem;
    }

    .detail-section-title {
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--stn);
      margin-bottom: 0.875rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .detail-section-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--mst);
    }

    /* ─── RELATION ROWS ───────────────────────────────────── */
    .relation-row {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.625rem 0;
      border-bottom: 1px solid var(--mst);
      cursor: pointer;
      transition: background 0.15s;
      border-radius: 6px;
      padding: 0.625rem 0.75rem;
      margin: 0 -0.75rem;
    }

    .relation-row:hover { background: var(--pch); }
    .relation-row:last-child { border-bottom: none; }

    .rel-type-tag {
      font-family: var(--mono);
      font-size: 0.65rem;
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      background: rgba(27,77,62,0.08);
      color: var(--hz);
      flex-shrink: 0;
      margin-top: 2px;
      white-space: nowrap;
    }

    .rel-target { flex: 1; }
    .rel-target-name { font-size: 0.85rem; font-weight: 500; color: var(--mid); }
    .rel-target-desc { font-size: 0.75rem; color: var(--stn); margin-top: 0.1rem; line-height: 1.4; }

    /* ─── TENSION ROWS ────────────────────────────────────── */
    .tension-row {
      background: white;
      border: 1px solid var(--mst);
      border-left: 3px solid var(--dn);
      border-radius: 0 0.5rem 0.5rem 0;
      padding: 0.875rem;
      margin-bottom: 0.625rem;
    }

    .tension-title { font-size: 0.875rem; font-weight: 600; color: var(--mid); margin-bottom: 0.25rem; }
    .tension-desc  { font-size: 0.78rem; color: var(--stn); line-height: 1.5; }

    .tension-meta {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .tension-chip {
      font-size: 0.66rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      padding: 0.1rem 0.4rem;
      border-radius: 3px;
    }

    .sev-fundamental { background: rgba(214,40,40,0.1); color: #a01010; }
    .sev-significant  { background: rgba(244,162,97,0.15); color: #8a4b0a; }
    .sev-minor        { background: rgba(108,117,125,0.1); color: var(--stn); }

    /* ─── EVIDENCE ROWS ────────────────────────────────────── */
    .evidence-row {
      display: flex;
      gap: 0.75rem;
      padding: 0.875rem 0;
      border-bottom: 1px solid var(--mst);
    }

    .evidence-row:last-child { border-bottom: none; }

    .ev-quality-bar {
      width: 4px;
      border-radius: 2px;
      flex-shrink: 0;
      background: var(--mst);
      align-self: stretch;
    }

    .ev-q-consensus    { background: #2D6A4F; }
    .ev-q-longitudinal { background: var(--hz2); }
    .ev-q-meta_analysis { background: #7FC8A9; }
    .ev-q-pilot        { background: var(--dn); }
    .ev-q-anecdotal    { background: var(--stn); }

    .ev-content { flex: 1; }
    .ev-title   { font-size: 0.875rem; font-weight: 600; color: var(--mid); margin-bottom: 0.2rem; }
    .ev-desc    { font-size: 0.75rem; color: var(--stn); line-height: 1.5; margin-bottom: 0.35rem; }
    .ev-meta    { display: flex; gap: 0.5rem; flex-wrap: wrap; }

    .ev-chip {
      font-size: 0.65rem;
      font-family: var(--mono);
      padding: 0.1rem 0.4rem;
      border-radius: 3px;
      background: var(--pch);
      color: var(--stn);
    }

    /* ─── FRAMEWORK ELEMENTS (pyramid) ────────────────────── */
    .pyramid-stack {
      display: flex;
      flex-direction: column-reverse;
      gap: 0.375rem;
      margin-bottom: 1.5rem;
    }

    .pyramid-layer-card {
      background: white;
      border: 1px solid var(--mst);
      border-radius: 0.5rem;
      padding: 0.875rem 1rem;
      display: grid;
      grid-template-columns: 36px 1fr;
      gap: 0.75rem;
      align-items: start;
      cursor: pointer;
      transition: all 0.15s;
    }

    .pyramid-layer-card:hover {
      border-color: var(--hz);
      background: rgba(27,77,62,0.02);
    }

    .pyramid-layer-num {
      width: 36px;
      height: 36px;
      background: var(--hz);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--serif);
      font-size: 1rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .pyramid-layer-title { font-size: 0.875rem; font-weight: 600; color: var(--hz); margin-bottom: 0.2rem; }
    .pyramid-layer-role  { font-size: 0.75rem; color: var(--stn); margin-bottom: 0.35rem; }
    .pyramid-layer-desc  { font-size: 0.75rem; color: var(--mid2); line-height: 1.5; }

    /* ─── TENSIONS OVERVIEW ───────────────────────────────── */
    .tensions-overview {
      margin-bottom: 2rem;
    }

    /* ─── CONCEPT GRID ─────────────────────────────────────── */
    .concept-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 0.75rem;
      margin-bottom: 2rem;
    }

    .concept-card {
      background: white;
      border: 1px solid var(--mst);
      border-radius: 0.625rem;
      padding: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .concept-card:hover {
      border-color: var(--hz2);
      box-shadow: 0 2px 8px rgba(27,77,62,0.08);
      transform: translateY(-1px);
    }

    .concept-card-code {
      font-family: var(--mono);
      font-size: 0.63rem;
      color: var(--stn);
      margin-bottom: 0.25rem;
    }

    .concept-card-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--mid);
      margin-bottom: 0.375rem;
      line-height: 1.3;
    }

    .concept-card-tags {
      display: flex;
      gap: 0.3rem;
      flex-wrap: wrap;
    }

    .ctype-chip {
      font-size: 0.6rem;
      font-weight: 600;
      padding: 0.1rem 0.35rem;
      border-radius: 3px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .ct-phenomenon  { background: rgba(231,111,81,0.1); color: #7a2000; }
    .ct-mechanism   { background: rgba(27,77,62,0.1);   color: var(--hz); }
    .ct-proposal    { background: rgba(107,154,196,0.15); color: #1d4f72; }
    .ct-critique    { background: rgba(244,162,97,0.15); color: #7a4208; }
    .ct-synthesis   { background: rgba(74,124,111,0.15); color: #2a5f53; }

    .domain-chip {
      font-size: 0.6rem;
      background: var(--pch);
      color: var(--stn);
      padding: 0.1rem 0.35rem;
      border-radius: 3px;
    }

    /* ─── LOADING / ERROR ─────────────────────────────────── */
    .loading-state {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      color: var(--stn);
      gap: 0.75rem;
      font-size: 0.875rem;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--mst);
      border-top-color: var(--hz);
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* ─── FILTER BAR ──────────────────────────────────────── */
    .filter-bar {
      display: flex;
      gap: 0.375rem;
      flex-wrap: wrap;
      margin-bottom: 1.25rem;
    }

    .filter-chip {
      font-size: 0.75rem;
      font-weight: 500;
      padding: 0.3rem 0.75rem;
      border-radius: 100px;
      border: 1px solid var(--mst);
      background: white;
      color: var(--stn);
      cursor: pointer;
      transition: all 0.15s;
    }

    .filter-chip:hover { border-color: var(--hz); color: var(--hz); }
    .filter-chip.active { background: var(--hz); color: white; border-color: var(--hz); }

    /* ─── RESPONSIVE ──────────────────────────────────────── */
    @media (max-width: 768px) {
      .nav-sidebar { display: none; }
    }

    /* ─── GRAPH PANEL ─────────────────────────────────────── */
    .graph-panel {
      display: none;
      flex: 1;
      position: relative;
      background: var(--mid);
      overflow: hidden;
    }
    .graph-panel.visible { display: flex; flex-direction: column; }

    .graph-toolbar {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.25rem;
      background: rgba(0,0,0,0.25);
      border-bottom: 1px solid rgba(255,255,255,0.07);
      flex-wrap: wrap;
      z-index: 10;
    }

    .graph-toolbar-title {
      font-family: var(--serif);
      font-size: 0.85rem;
      color: var(--dn);
      font-weight: 600;
      margin-right: 0.5rem;
    }

    .graph-filter-btn {
      font-size: 0.7rem;
      padding: 0.25rem 0.625rem;
      border-radius: 100px;
      border: 1px solid rgba(255,255,255,0.15);
      background: transparent;
      color: rgba(255,255,255,0.6);
      cursor: pointer;
      transition: all 0.15s;
      font-family: var(--mono);
    }
    .graph-filter-btn:hover { border-color: rgba(255,255,255,0.4); color: white; }
    .graph-filter-btn.active { background: var(--hz); border-color: var(--hz); color: white; }

    .graph-close-btn {
      margin-left: auto;
      font-size: 0.72rem;
      padding: 0.25rem 0.625rem;
      border-radius: 4px;
      border: 1px solid rgba(255,255,255,0.15);
      background: transparent;
      color: rgba(255,255,255,0.5);
      cursor: pointer;
      transition: all 0.15s;
    }
    .graph-close-btn:hover { color: white; border-color: rgba(255,255,255,0.4); }

    #graph-svg {
      flex: 1;
      width: 100%;
    }

    .graph-legend {
      position: absolute;
      bottom: 1rem;
      left: 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
      pointer-events: none;
    }

    .legend-row {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.65rem;
      color: rgba(255,255,255,0.5);
      font-family: var(--mono);
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .legend-line {
      width: 20px;
      height: 2px;
      flex-shrink: 0;
    }

    .graph-tooltip {
      position: fixed;
      background: rgba(13,27,42,0.95);
      border: 1px solid rgba(244,162,97,0.3);
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      font-size: 0.72rem;
      color: white;
      pointer-events: none;
      z-index: 1000;
      max-width: 220px;
      display: none;
    }

    .graph-tooltip-title {
      font-family: var(--serif);
      font-size: 0.8rem;
      color: var(--dn);
      margin-bottom: 0.2rem;
    }

    .graph-tooltip-type {
      font-family: var(--mono);
      font-size: 0.63rem;
      color: rgba(255,255,255,0.45);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Graph button in overview */
    .graph-launch-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(244,162,97,0.12);
      border: 1px solid rgba(244,162,97,0.3);
      border-radius: 6px;
      color: var(--dn);
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 1rem;
      font-family: var(--sans);
    }
    .graph-launch-btn:hover {
      background: rgba(244,162,97,0.2);
      border-color: rgba(244,162,97,0.6);
    }

  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="index.html" class="logo">
      <span class="logo-symbol">L/0</span>
      <span class="logo-text">Post-Labor Economics</span>
    </a>
      <nav class="nav-menu">
        <a href="index.html" class="nav-link">Home</a>
        <a href="metamodel.html" class="nav-link">Metamodel</a>
        <a href="architecture.html" class="nav-link">Architecture</a>
        <a href="proposals.html" class="nav-link">Proposals</a>
        <a href="projects.html" class="nav-link">Projects</a>
        <a href="gato.html" class="nav-link">GATO</a>
        <a href="prime.html" class="nav-link">PRIME</a>
      </nav>
    <div class="header-right">
      <a href="login.html" id="login-btn" style="font-size:0.8rem; color:rgba(255,255,255,0.6); text-decoration:none;">Sign In</a>
    </div>
  </header>

  <div class="page-wrap">
    <!-- Left Navigator Sidebar -->
    <nav class="nav-sidebar">
      <div class="nav-sidebar-header">
        <div class="nav-sidebar-title">Ontology Navigator</div>
        <div class="nav-search">
          <i data-lucide="search"></i>
          <input type="text" id="nav-search-input" placeholder="Search concepts…">
        </div>
      </div>
      <div class="nav-sections">
        <!-- Frameworks -->
        <div class="nav-section open" data-section="frameworks">
          <div class="nav-section-header">
            <span class="nav-section-label">
              <span>Frameworks</span>
              <span class="nav-section-count" id="fw-count">—</span>
            </span>
            <i data-lucide="chevron-right" class="nav-section-chevron"></i>
          </div>
          <div class="nav-items" id="nav-frameworks"></div>
        </div>
        <!-- Concepts — Phenomena -->
        <div class="nav-section open" data-section="phenomena">
          <div class="nav-section-header">
            <span class="nav-section-label">
              <span>Phenomena</span>
              <span class="nav-section-count" id="phen-count">—</span>
            </span>
            <i data-lucide="chevron-right" class="nav-section-chevron"></i>
          </div>
          <div class="nav-items" id="nav-phenomena"></div>
        </div>
        <!-- Concepts — Proposals -->
        <div class="nav-section" data-section="proposals">
          <div class="nav-section-header">
            <span class="nav-section-label">
              <span>Proposals</span>
              <span class="nav-section-count" id="prop-count">—</span>
            </span>
            <i data-lucide="chevron-right" class="nav-section-chevron"></i>
          </div>
          <div class="nav-items" id="nav-proposals"></div>
        </div>
        <!-- Concepts — Mechanisms -->
        <div class="nav-section" data-section="mechanisms">
          <div class="nav-section-header">
            <span class="nav-section-label">
              <span>Mechanisms</span>
              <span class="nav-section-count" id="mech-count">—</span>
            </span>
            <i data-lucide="chevron-right" class="nav-section-chevron"></i>
          </div>
          <div class="nav-items" id="nav-mechanisms"></div>
        </div>
        <!-- Critiques & Syntheses -->
        <div class="nav-section" data-section="critiques">
          <div class="nav-section-header">
            <span class="nav-section-label">
              <span>Critiques & Syntheses</span>
              <span class="nav-section-count" id="crit-count">—</span>
            </span>
            <i data-lucide="chevron-right" class="nav-section-chevron"></i>
          </div>
          <div class="nav-items" id="nav-critiques"></div>
        </div>
        <!-- Tensions -->
        <div class="nav-section" data-section="tensions">
          <div class="nav-section-header">
            <span class="nav-section-label">
              <span>Tensions</span>
              <span class="nav-section-count" id="ten-count">—</span>
            </span>
            <i data-lucide="chevron-right" class="nav-section-chevron"></i>
          </div>
          <div class="nav-items" id="nav-tensions"></div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="main-area" id="main-area">
      <!-- Overview (default) -->
      <div class="overview-panel" id="overview-panel">
        <div class="overview-hero">
          <h1>PLE Holistic Metamodel</h1>
          <p>
            The ontological architecture of Post-Labor Economics — a typed vocabulary of concepts, frameworks, 
            mechanisms, and their relationships. Navigate the intellectual structure of the movement.
          </p>
          <div class="hero-stats">
            <div><div class="hero-stat-val" id="stat-frameworks">—</div><div class="hero-stat-lbl">Frameworks</div></div>
            <div><div class="hero-stat-val" id="stat-concepts">—</div><div class="hero-stat-lbl">Concepts</div></div>
            <div><div class="hero-stat-val" id="stat-tensions">—</div><div class="hero-stat-lbl">Tensions</div></div>
            <div><div class="hero-stat-val" id="stat-evidence">—</div><div class="hero-stat-lbl">Evidence Sources</div></div>
          </div>
          <button class="graph-launch-btn" onclick="showGraph()">
            ⬡ Explore Relationship Graph
          </button>
        </div>

        <!-- Four Layers -->
        <div class="section-title">Four Metamodel Layers</div>
        <div class="metamodel-layers">
          <div class="layer-card" onclick="showConceptsBrowser('all')">
            <div class="layer-card-num">Layer 1 — Theory</div>
            <div class="layer-card-title">Concepts & Tensions</div>
            <div class="layer-card-desc">What PLE thinks — phenomena, mechanisms, proposals, critiques, syntheses, and the documented trade-offs between them.</div>
            <div class="layer-card-types">
              <span class="type-chip" style="color:#7a2000">phenomenon</span>
              <span class="type-chip" style="color:var(--hz)">mechanism</span>
              <span class="type-chip" style="color:#1d4f72">proposal</span>
              <span class="type-chip" style="color:#7a4208">critique</span>
              <span class="type-chip" style="color:#2a5f53">synthesis</span>
            </div>
          </div>
          <div class="layer-card" onclick="showFrameworks()">
            <div class="layer-card-num">Layer 2 — Architecture</div>
            <div class="layer-card-title">Frameworks & Models</div>
            <div class="layer-card-desc">How PLE organizes its thinking — the major analytical frameworks (L/0, Pyramids, GATO, PRIME, LVN) and their internal structures.</div>
            <div class="layer-card-types">
              <span class="type-chip" style="color:var(--hz)">framework</span>
              <span class="type-chip" style="color:var(--sge)">model</span>
              <span class="type-chip" style="color:var(--stn)">layer</span>
            </div>
          </div>
          <div class="layer-card" onclick="showTensions()">
            <div class="layer-card-num">Layer 3 — Praxis</div>
            <div class="layer-card-title">Tensions & Trade-offs</div>
            <div class="layer-card-desc">What PLE has not yet resolved — the fundamental dilemmas that honest post-labor theory must acknowledge rather than paper over.</div>
            <div class="layer-card-types">
              <span class="type-chip" style="color:#a01010">fundamental</span>
              <span class="type-chip" style="color:#8a4b0a">significant</span>
              <span class="type-chip" style="color:var(--stn)">minor</span>
            </div>
          </div>
          <div class="layer-card" onclick="showEvidence()">
            <div class="layer-card-num">Layer 4 — Epistemology</div>
            <div class="layer-card-title">Evidence & Lineage</div>
            <div class="layer-card-desc">How PLE knows — empirical anchors from real experiments, case studies, and research, plus the intellectual lineage the movement draws on and responds to.</div>
            <div class="layer-card-types">
              <span class="type-chip" style="color:#1d4b35">case study</span>
              <span class="type-chip" style="color:var(--hz2)">research</span>
              <span class="type-chip" style="color:var(--stn)">lineage</span>
            </div>
          </div>
        </div>

        <!-- Frameworks Quick View -->
        <div class="section-title">Core Frameworks</div>
        <div class="fw-grid" id="fw-overview-grid">
          <div class="loading-state"><div class="spinner"></div> Loading frameworks…</div>
        </div>
      </div>

      <!-- Detail Panel -->
      <div class="detail-panel" id="detail-panel">
        <div class="detail-back" onclick="showOverview()">
          <i data-lucide="arrow-left" style="width:14px;height:14px"></i>
          Back to overview
        </div>
        <div id="detail-content"></div>
      </div>
    </div>

      <!-- Graph Panel -->
      <div class="graph-panel" id="graph-panel">
        <div class="graph-toolbar">
          <span class="graph-toolbar-title">Knowledge Graph</span>
          <button class="graph-filter-btn active" data-rel-filter="all">All Relations</button>
          <button class="graph-filter-btn" data-rel-filter="enables">enables</button>
          <button class="graph-filter-btn" data-rel-filter="conflicts_with">conflicts</button>
          <button class="graph-filter-btn" data-rel-filter="instantiates">instantiates</button>
          <button class="graph-filter-btn" data-rel-filter="addresses">addresses</button>
          <button class="graph-filter-btn" data-rel-filter="part_of">part of</button>
          <button class="graph-close-btn" onclick="closeGraph()">✕ Close</button>
        </div>
        <svg id="graph-svg"></svg>
        <div class="graph-legend" id="graph-legend">
          <div class="legend-row"><div class="legend-dot" style="background:#e07b4f"></div>phenomenon</div>
          <div class="legend-row"><div class="legend-dot" style="background:#1B4D3E"></div>proposal</div>
          <div class="legend-row"><div class="legend-dot" style="background:#4a7c6f"></div>mechanism</div>
          <div class="legend-row"><div class="legend-dot" style="background:#5b4a8a"></div>synthesis</div>
          <div class="legend-row"><div class="legend-dot" style="background:#8b3a3a"></div>critique</div>
          <div class="legend-row"><div class="legend-dot" style="background:#F4A261;border-radius:3px"></div>framework</div>
        </div>
      </div>
      <div class="graph-tooltip" id="graph-tooltip">
        <div class="graph-tooltip-title" id="tt-title"></div>
        <div class="graph-tooltip-type" id="tt-type"></div>
      </div>

  </div>

  <script>
    // ─────────────────────────────────────────────
    // EMBEDDED STATIC DATA (full dataset — no API required)
    // API optionally refreshes this when deployed to Netlify
    // ─────────────────────────────────────────────

    const STATIC = {
      frameworks: [
        { id: 'fw-l0',   code: 'FW-L0',   title: 'L/0 Thesis (Labor Zero)',      summary: 'The foundational claim that obligatory human labor is ending — not that humans will stop doing things, but that economic compulsion to work will dissolve as AI and automation perform most productive work.',                                         scope: 'descriptive', completeness: 'complete', layer_count: 0,
          elements: [] },
        { id: 'fw-pros', code: 'FW-PROS', title: 'Pyramid of Prosperity',        summary: 'Five-layer architecture for distributing income and wealth to households after labor ceases to be the primary distribution mechanism. Layers are ordered by universality — lower layers cover everyone, higher layers are more differentiated.', scope: 'normative',   completeness: 'complete', layer_count: 5,
          elements: [
            { layer_number:1, title:'Layer 1 — Universals',                    element_role:'Income and services guaranteed to all',                   description:'The unconditional floor — UBI, Universal Healthcare, Universal Basic Services. Not means-tested, not conditional on work. The foundation of post-labor prosperity.' },
            { layer_number:2, title:'Layer 2 — Collectively Owned Public Assets', element_role:'Returns on public ownership distributed to all',        description:'Returns from assets owned in common — sovereign wealth funds, resource royalties, public infrastructure. Real examples: Norway GPF, Alaska Permanent Fund.' },
            { layer_number:3, title:'Layer 3 — Collectively Owned Private Assets', element_role:'Cooperative and collective ownership income',          description:'Returns distributed to workers and communities rather than external investors. Cooperatives, ESOPs, DAOs, data cooperatives. Mondragon as proof of scale.' },
            { layer_number:4, title:'Layer 4 — Individual Private Assets',     element_role:'Personal capital returns',                                description:'Returns on personally owned assets — investment portfolios, Baby Bonds, home equity. Present in every economy; democratized through earlier layers.' },
            { layer_number:5, title:'Layer 5 — Meaningful Work Income',        element_role:'Voluntary, meaning-driven labor income',                  description:'Wages for work chosen for meaning, not compulsion — care professions, creative work, craft, research. Top of the pyramid, not the base.' }
          ]},
        { id: 'fw-pow',  code: 'FW-POW',  title: 'Pyramid of Power',            summary: 'Five-layer architecture for maintaining democratic leverage and civic participation after labor power (strikes, collective bargaining) sunsets. Each layer is a different substrate of power.',                                                    scope: 'normative',   completeness: 'complete', layer_count: 5,
          elements: [
            { layer_number:1, title:'Layer 1 — Immutable Civic Bedrock',       element_role:'Incorruptible identity and property foundation',           description:'Tamper-proof identity, property records, legal rights. Democratic power begins with certainty about who exists and what is theirs.' },
            { layer_number:2, title:'Layer 2 — Open Payment Rails',            element_role:'Universal financial access and interoperability',          description:'Universal, interoperable, affordable financial infrastructure. India UPI, Brazil Pix as real examples. When anyone can transact with anyone, participation becomes a right.' },
            { layer_number:3, title:'Layer 3 — Radical Transparency',          element_role:'Visibility into how power is actually exercised',          description:'Open procurement, auditable algorithms, transparent budgets, accessible data. Citizens cannot govern what they cannot see.' },
            { layer_number:4, title:'Layer 4 — Direct Democracy',              element_role:'Direct citizen participation in consequential decisions',   description:'Participatory budgeting, liquid democracy, referenda, DAOs. Porto Alegre (1989) as proof of concept at city scale.' },
            { layer_number:5, title:'Layer 5 — Meta-Governance',               element_role:'Governance of governance systems themselves',              description:'The rules for changing the rules — constitutional design for the post-labor era. Who governs the AI systems? Who can modify the payment rails?' }
          ]},
        { id: 'fw-gato', code: 'FW-GATO', title: 'GATO Framework',              summary: 'Global Automated Trade Organization — proposed international governance architecture to manage AI and automation at planetary scale, analogous to WTO for trade but designed for the post-labor era.',                                               scope: 'analytical',  completeness: 'draft',    layer_count: 0,
          elements: [] },
        { id: 'fw-prime',code: 'FW-PRIME',title: 'PRIME Framework',             summary: 'A rubric for evaluating post-labor policy proposals across five dimensions: Practicality, Rights, Implementation, Monitoring, and Equity. Provides structured assessment beyond single-axis analysis.',                                               scope: 'evaluative',  completeness: 'complete', layer_count: 5,
          elements: [
            { layer_number:1, title:'P — Practicality',  element_role:'Feasibility and real-world implementation assessment',   description:'Can this actually be implemented? Accounts for political feasibility, administrative capacity, behavioral economics, and path dependencies.' },
            { layer_number:2, title:'R — Rights',        element_role:'Rights impacts and human dignity assessment',            description:'Does this proposal respect and expand fundamental rights? Does it create new rights or responsibilities? Who is left out?' },
            { layer_number:3, title:'I — Implementation',element_role:'Implementation path and institutional requirements',    description:'What institutions, processes, and capabilities are required? What is the transition path? What fails first?' },
            { layer_number:4, title:'M — Monitoring',    element_role:'Measurement, evaluation, and feedback loop design',     description:'How will we know if this works? What are the leading indicators, failure modes? What data must be collected?' },
            { layer_number:5, title:'E — Equity',        element_role:'Distributional impact and justice assessment',          description:'Who benefits, and by how much? Who bears costs? Does this narrow or widen gaps across race, gender, geography, age, and class?' }
          ]},
        { id: 'fw-lvn',  code: 'FW-LVN',  title: 'Latent Value Network',        summary: 'Framework for mapping, understanding, and surfacing the vast substrate of human value that markets have never learned to measure — care, knowledge commons, social infrastructure, ecological stewardship, creative culture, and civic participation.', scope: 'analytical',  completeness: 'draft',    layer_count: 6,
          elements: [
            { layer_number:1, title:'Category 1 — Care Value',              element_role:'Human biological and emotional sustenance',    description:'Childrearing, elder care, disability support, emotional labor, and the work of sustaining human beings through vulnerability.' },
            { layer_number:2, title:'Category 2 — Knowledge Commons',       element_role:'Shared knowledge infrastructure',              description:'Open source, Wikipedia, academic preprints, informal teaching, and every act of sharing knowledge beyond market transactions.' },
            { layer_number:3, title:'Category 3 — Social Infrastructure',   element_role:'Social cohesion and community maintenance',    description:'Trust networks, community organizing, conflict mediation, social norms maintenance, and the invisible work of keeping communities functional.' },
            { layer_number:4, title:'Category 4 — Ecological Stewardship',  element_role:'Ecological health and commons stewardship',    description:'Land tending, biodiversity maintenance, watershed protection, climate resilience work, and management of commons under threat.' },
            { layer_number:5, title:'Category 5 — Creative Culture',        element_role:'Meaning-making and cultural reproduction',     description:'Art, music, storytelling, ritual, and cultural production that builds collective meaning, identity, and shared imaginative life.' },
            { layer_number:6, title:'Category 6 — Civic Participation',     element_role:'Democratic and civic value creation',          description:'Voting, volunteering, local governance, watchdog journalism, whistleblowing, protest, and every act of democratic self-governance beyond formal employment.' }
          ]}
      ],
      concepts: [
        // Phenomena
        { id:'c-l0',   code:'CON-L0',   title:'L/0 (Labor Zero)',           concept_type:'phenomenon', domain:'economic',      maturity:'established', confidence:'supported',  is_core_ple:true,  origin_tradition:'David Shapiro / PLE Movement',             summary:'The thesis that obligatory human labor is ending. The "/" evokes division by zero — an operation that breaks mathematics, just as zero labor breaks conventional economics. Not about banning work, but ending coercion.' },
        { id:'c-lab',  code:'CON-LAB',  title:'Laborism',                  concept_type:'phenomenon', domain:'philosophical', maturity:'established', confidence:'consensus',  is_core_ple:true,  origin_tradition:'Cultural criticism',                        summary:'The invisible ideology that work is morally necessary — that people should work regardless of whether their work is needed. Spans left (dignity of work) and right (no free lunch). The primary cultural obstacle to post-labor economics.' },
        { id:'c-taum', code:'CON-TAUM', title:'Technological Unemployment', concept_type:'phenomenon', domain:'economic',      maturity:'established', confidence:'consensus',  is_core_ple:true,  origin_tradition:'John Maynard Keynes (1930)',                 summary:'Job losses caused by technological advancement that outpaces new role creation. Distinguished from cyclical unemployment by its structural, permanent character. The empirical driver behind PLE.' },
        { id:'c-prec', code:'CON-PREC', title:'Precariat',                  concept_type:'phenomenon', domain:'social',        maturity:'established', confidence:'supported',  is_core_ple:true,  origin_tradition:'Guy Standing',                              summary:'A growing social class defined by precarious work, temporary contracts, and lack of employment benefits. The transitional condition between full employment and post-labor.' },
        { id:'c-care', code:'CON-CARE', title:'Care Economy',               concept_type:'phenomenon', domain:'economic',      maturity:'established', confidence:'supported',  is_core_ple:true,  origin_tradition:'Nancy Folbre, feminist economics',           summary:'The vast, unpaid economy of care work — childcare, eldercare, sick care, emotional labor — performed primarily by women. Invisible to GDP, foundational to everything GDP does measure.' },
        { id:'c-lval', code:'CON-LVAL', title:'Latent Value',               concept_type:'phenomenon', domain:'economic',      maturity:'developing',  confidence:'contested',  is_core_ple:true,  origin_tradition:'PLE / LVN framework',                       summary:'Economic and social value that exists and is real but is not measured, priced, or compensated by formal markets. The substrate of human flourishing that economies fail to account for.' },
        { id:'c-wlth', code:'CON-WLTH', title:'Wealth Concentration',       concept_type:'phenomenon', domain:'economic',      maturity:'established', confidence:'consensus',  is_core_ple:true,  origin_tradition:'Thomas Piketty',                            summary:'The accelerating concentration of capital ownership in fewer hands as returns to capital outpace returns to labor (r > g). The distributional crisis that post-labor economics must solve.' },
        { id:'c-algp', code:'CON-ALGP', title:'Algorithmic Power',          concept_type:'phenomenon', domain:'political',     maturity:'developing',  confidence:'contested',  is_core_ple:true,  origin_tradition:'PLE Movement',                              summary:'The emerging form of power exercised through control of AI systems, data, and algorithmic infrastructure. Must replace traditional labor power (strikes, collective bargaining) in the post-labor era.' },
        // Mechanisms
        { id:'c-coop', code:'CON-COOP', title:'Cooperative Ownership',      concept_type:'mechanism',  domain:'economic',      maturity:'canonical',   confidence:'consensus',  is_core_ple:true,  origin_tradition:'Rochdale Principles (1844)',                 summary:'Enterprise owned by those who do the work (workers) or use the services (consumers). Distributes returns to labor and community rather than external capital. Mondragon at 80,000 members shows scale.' },
        { id:'c-dao',  code:'CON-DAO',  title:'Decentralized Autonomous Organization', concept_type:'mechanism', domain:'technical', maturity:'developing', confidence:'contested', is_core_ple:true, origin_tradition:'Ethereum community',                         summary:'Governance and ownership structure implemented in code — rules enforced by smart contracts rather than legal institutions. An emerging mechanism for commons governance and collective ownership at scale.' },
        { id:'c-lvt',  code:'CON-LVT',  title:'Land Value Tax',             concept_type:'mechanism',  domain:'economic',      maturity:'established', confidence:'contested',  is_core_ple:true,  origin_tradition:'Henry George (1879)',                        summary:'A tax on the unimproved value of land (not structures), discouraging speculation while funding public goods. Aligns incentives for productive land use and community investment.' },
        { id:'c-dtax', code:'CON-DTAX', title:'Data Dividend / Data Tax',   concept_type:'mechanism',  domain:'economic',      maturity:'developing',  confidence:'contested',  is_core_ple:true,  origin_tradition:'Jaron Lanier / Andrew Yang',                 summary:'Mechanisms to compensate individuals for the value of their data contributions to AI systems, or to tax extractive data collection. A form of latent value recognition for the digital economy.' },
        { id:'c-tbke', code:'CON-TBKE', title:'Timebank',                   concept_type:'mechanism',  domain:'social',        maturity:'developing',  confidence:'supported',  is_core_ple:true,  origin_tradition:'Edgar Cahn / Time Dollars',                 summary:'Community exchange where time is the currency — one hour of any service equals one credit. Surfaces and compensates latent value without markets, while building social infrastructure.' },
        { id:'c-cbdc', code:'CON-CBDC', title:'Central Bank Digital Currency', concept_type:'mechanism', domain:'technical',   maturity:'developing',  confidence:'contested',  is_core_ple:false, origin_tradition:'Central banking research',                  summary:'Digital sovereign currency issued by a central bank. Has potential to implement open payment rails directly, bypassing private banking infrastructure.' },
        // Proposals
        { id:'c-ubi',  code:'CON-UBI',  title:'Universal Basic Income',     concept_type:'proposal',   domain:'economic',      maturity:'canonical',   confidence:'contested',  is_core_ple:true,  origin_tradition:'Thomas Paine / Milton Friedman / many',     summary:'Unconditional, regular cash payment to every adult citizen, regardless of work status, income, or behavior. The most discussed post-labor income proposal. Addresses Prosperity Layer 1.' },
        { id:'c-uhc',  code:'CON-UHC',  title:'Universal Healthcare',       concept_type:'proposal',   domain:'economic',      maturity:'canonical',   confidence:'supported',  is_core_ple:true,  origin_tradition:'Beveridge Report (1942)',                    summary:'Healthcare as a universal right, funded collectively. Part of Prosperity Layer 1 universals. Decouples healthcare from labor market participation.' },
        { id:'c-swf',  code:'CON-SWF',  title:'Sovereign Wealth Fund',      concept_type:'proposal',   domain:'economic',      maturity:'established', confidence:'supported',  is_core_ple:true,  origin_tradition:'Kuwait Investment Authority (1953)',         summary:'State-owned investment fund returning dividends to citizens. Prosperity Layer 2 mechanism. Transforms common ownership of natural resources into universal income streams.' },
        { id:'c-rtax', code:'CON-RTAX', title:'Robot Tax / Automation Tax', concept_type:'proposal',   domain:'economic',      maturity:'developing',  confidence:'contested',  is_core_ple:true,  origin_tradition:'Bill Gates / IMF researchers',              summary:'A tax on automation deployment to fund transition programs, UBI, or sovereign wealth funds. Aligns incentives by making the entity that displaces workers contribute to their support.' },
        { id:'c-prtb', code:'CON-PRTB', title:'Participatory Budgeting',    concept_type:'proposal',   domain:'political',     maturity:'established', confidence:'supported',  is_core_ple:true,  origin_tradition:'Porto Alegre, Brazil (1989)',                summary:'Democratic process where community members directly decide how to allocate a portion of a public budget. Power Layer 4 mechanism. Proven in hundreds of cities since 1989.' },
        { id:'c-liq',  code:'CON-LIQ',  title:'Liquid Democracy',           concept_type:'proposal',   domain:'political',     maturity:'developing',  confidence:'contested',  is_core_ple:true,  origin_tradition:'Computer science / Delegative democracy',    summary:'Hybrid of direct and representative democracy — citizens can vote directly or delegate their votes to trusted proxies who can further re-delegate. Power Layer 4 mechanism.' },
        { id:'c-bbnd', code:'CON-BBND', title:'Baby Bonds',                 concept_type:'proposal',   domain:'economic',      maturity:'developing',  confidence:'contested',  is_core_ple:true,  origin_tradition:'William Darity / Darrick Hamilton',          summary:'Universal endowment given to every newborn, invested and accessible at adulthood. Creates a universal foundation of private capital (Prosperity Layer 4) regardless of family wealth.' },
        // Critiques
        { id:'c-antl', code:'CON-ANTL', title:'Anti-Laborism',              concept_type:'critique',   domain:'philosophical', maturity:'developing',  confidence:'contested',  is_core_ple:true,  origin_tradition:'PLE Movement',                              summary:'The normative claim that laborism — the ideology that work is morally necessary — is wrong, harmful, and should be dismantled. The ideological foundation of the PLE movement.' },
        { id:'c-dgro', code:'CON-DGRO', title:'Degrowth',                   concept_type:'critique',   domain:'ecological',    maturity:'developing',  confidence:'contested',  is_core_ple:false, origin_tradition:'Serge Latouche / Herman Daly',              summary:'The proposal that wealthy economies should deliberately shrink rather than endlessly grow, prioritizing wellbeing over GDP. Intersects with PLE without fully aligning.' },
        // Syntheses
        { id:'c-lvnx', code:'CON-LVNX', title:'Latent Value Network',       concept_type:'synthesis',  domain:'economic',      maturity:'embryonic',   confidence:'speculative',is_core_ple:true,  origin_tradition:'Travis Sillio / Claude / PLE',              summary:'A synthetic framework for mapping, understanding, and surfacing the vast substrate of human value that markets fail to measure — care, knowledge commons, social infrastructure, ecological stewardship, creative culture, and civic participation.' },
        { id:'c-soec', code:'CON-SOEC', title:'Solidarity Economy',         concept_type:'synthesis',  domain:'economic',      maturity:'established', confidence:'supported',  is_core_ple:true,  origin_tradition:'Latin American social movements',            summary:'Economic ecosystem grounded in cooperation, mutual aid, democratic governance, and social purpose. Includes cooperatives, credit unions, timebanks, mutual aid networks.' },
        { id:'c-dnut', code:'CON-DNUT', title:'Doughnut Economics',         concept_type:'synthesis',  domain:'ecological',    maturity:'established', confidence:'supported',  is_core_ple:false, origin_tradition:'Kate Raworth (2017)',                        summary:'Replaces GDP growth as the goal with a "safe and just space for humanity" — above a social foundation, within ecological ceilings. Complements PLE by providing the ecological and wellbeing frame.' },
        { id:'c-plat', code:'CON-PLAT', title:'Platform Cooperativism',     concept_type:'synthesis',  domain:'technical',     maturity:'developing',  confidence:'supported',  is_core_ple:true,  origin_tradition:'Trebor Scholz / Nathan Schneider',           summary:'Application of cooperative ownership models to digital platforms — apps, marketplaces, and networks owned by their workers and users. Combines digital scale with cooperative governance.' }
      ],
      tensions: [
        { id:'t-001', code:'TEN-001', title:'UBI Conditionality vs. Unconditional Dignity',        tension_type:'normative',       severity:'fundamental', resolution_status:'unresolved', description:'If UBI becomes the foundation of income, will society develop informal expectations that recipients should contribute to the Latent Value Network — effectively re-conditioning what was supposed to be unconditional? This undermines the rights-basis of UBI.' },
        { id:'t-002', code:'TEN-002', title:'Automation Speed vs. Institutional Adaptation',       tension_type:'empirical',       severity:'fundamental', resolution_status:'unresolved', description:'Automation may displace workers faster than institutions can adapt — creating a gap where old systems have broken down but new systems are not yet operational. This is the most dangerous transition risk.' },
        { id:'t-003', code:'TEN-003', title:'Data Dividends vs. Surveillance Architecture',        tension_type:'normative',       severity:'fundamental', resolution_status:'unresolved', description:'Compensating people for data contribution requires measuring what they contribute — which requires surveillance of intimate behaviors. Any LVN or data dividend mechanism risks creating a measurement apparatus more dangerous than the problem it solves.' },
        { id:'t-004', code:'TEN-004', title:'Collective Ownership vs. Individual Liberty',         tension_type:'normative',       severity:'significant', resolution_status:'unresolved', description:'Expanding cooperatives, commons, and collective governance inevitably constrains individual property rights and economic autonomy. How much collective governance is compatible with a free society?' },
        { id:'t-005', code:'TEN-005', title:'Ecological Value vs. Human Network Framing',          tension_type:'empirical',       severity:'significant', resolution_status:'unresolved', description:'The LVN uses a "network" metaphor implying human agency. But ecological value (clean air, biodiversity) is produced by nature, not human actors. Does including it stretch the concept beyond coherence?' },
        { id:'t-006', code:'TEN-006', title:'Global Solutions vs. Nation-State Sovereignty',       tension_type:'political',       severity:'fundamental', resolution_status:'unresolved', description:'Post-labor economics requires global coordination (GATO, cross-border wealth redistribution, AI governance) that nation-states are constitutionally and politically unable to deliver. The scale of the problem exceeds existing institutional authority.' },
        { id:'t-007', code:'TEN-007', title:'Laborism as Identity vs. Liberation from Obligation', tension_type:'normative',       severity:'significant', resolution_status:'unresolved', description:'Many people find genuine meaning and identity in their work. Dismantling laborism as an ideology risks delegitimizing authentic vocational identity, not just coerced labor. How do we liberate without erasing?' },
        { id:'t-008', code:'TEN-008', title:'Robot Tax Revenue vs. Innovation Incentives',         tension_type:'empirical',       severity:'significant', resolution_status:'unresolved', description:'Taxing automation raises revenue for transition programs but may slow the automation that eventually creates post-labor abundance. The optimal timing and rate is deeply contested.' }
      ],
      evidence: [
        { id:'e-001', code:'EV-001', title:'Alaska Permanent Fund Dividend',          evidence_type:'case_study', quality:'longitudinal', location:'Alaska, USA',          time_period:'1982–present', description:'Annual dividend paid to all Alaska residents from oil revenues invested in the Permanent Fund. ~$1,000-2,000/year since 1982. The most successful real-world model of Prosperity Layer 2.' },
        { id:'e-002', code:'EV-002', title:'Finland UBI Experiment',                  evidence_type:'case_study', quality:'longitudinal', location:'Finland',              time_period:'2017-2018',    description:'Government-run RCT giving 2,000 unemployed Finns €560/month unconditionally for 2 years. Found improved wellbeing, trust, and slight employment increases vs. control group.' },
        { id:'e-003', code:'EV-003', title:'Mondragon Corporation',                   evidence_type:'case_study', quality:'longitudinal', location:'Basque Country, Spain', time_period:'1956–present', description:'A federation of 80+ worker cooperatives employing ~80,000 people. The most scaled cooperative enterprise in the world. Demonstrates Prosperity Layer 3 at industrial scale.' },
        { id:'e-004', code:'EV-004', title:'Kenya GiveDirectly Cash Transfer Study',  evidence_type:'research',   quality:'longitudinal', location:'Kenya',                 time_period:'2011–present', description:'Long-running RCT of unconditional cash transfers in rural Kenya. Found sustained positive effects on consumption, assets, and psychological wellbeing with no evidence of harmful spending.' },
        { id:'e-005', code:'EV-005', title:'Porto Alegre Participatory Budgeting',    evidence_type:'case_study', quality:'longitudinal', location:'Porto Alegre, Brazil',  time_period:'1989–2004',    description:'Pioneering participatory budgeting implementation. Citizens directly allocated portions of the city budget. Dramatically improved infrastructure in poorer neighborhoods.' },
        { id:'e-006', code:'EV-006', title:'Stockton SEED Guaranteed Income Pilot',  evidence_type:'case_study', quality:'pilot',        location:'Stockton, California',  time_period:'2019-2021',    description:'$500/month to 125 low-income residents for 24 months. Full-time employment increased, mental health improved, recipients invested in education and family.' },
        { id:'e-007', code:'EV-007', title:'Wikipedia Knowledge Commons',             evidence_type:'case_study', quality:'longitudinal', location:'Global',               time_period:'2001–present', description:'Millions of volunteers maintaining 60+ million articles in 300+ languages. Demonstrates non-market contribution can sustain public goods at massive scale.' },
        { id:'e-008', code:'EV-008', title:'India UPI Payment Rail',                  evidence_type:'case_study', quality:'longitudinal', location:'India',                time_period:'2016–present', description:'Unified Payments Interface processed $1.7 trillion in transactions in 2023 — open, interoperable, real-time payment infrastructure bringing financial access to hundreds of millions.' },
        { id:'e-009', code:'EV-009', title:'Piketty r > g Analysis',                  evidence_type:'research',   quality:'meta_analysis',location:'Global (historical)',   time_period:'1700–2012',    description:"Thomas Piketty's analysis in Capital in the 21st Century (2013) demonstrating that returns on capital historically exceed economic growth, leading to increasing wealth concentration without policy correction." }
      ],
      sources: [],
      relations: [
        // Core causal chain: L/0 → distributional response
        { source:'c-l0',   target:'c-taum',  type:'enables',       weight:0.95 },
        { source:'c-taum', target:'c-ubi',   type:'addresses',     weight:0.9  },
        { source:'c-taum', target:'c-rtax',  type:'addresses',     weight:0.85 },
        { source:'c-taum', target:'c-prec',  type:'enables',       weight:0.9  },
        { source:'c-lab',  target:'c-l0',    type:'conflicts_with',weight:0.95 },
        { source:'c-antl', target:'c-lab',   type:'challenges',    weight:0.95 },
        { source:'c-wlth', target:'c-ubi',   type:'addresses',     weight:0.85 },
        { source:'c-wlth', target:'c-lvt',   type:'addresses',     weight:0.8  },
        // Prosperity layers
        { source:'c-ubi',  target:'fw-pros', type:'instantiates',  weight:0.95 },
        { source:'c-uhc',  target:'fw-pros', type:'instantiates',  weight:0.9  },
        { source:'c-swf',  target:'fw-pros', type:'instantiates',  weight:0.9  },
        { source:'c-coop', target:'fw-pros', type:'instantiates',  weight:0.9  },
        { source:'c-bbnd', target:'fw-pros', type:'instantiates',  weight:0.85 },
        { source:'c-rtax', target:'c-swf',   type:'enables',       weight:0.8  },
        { source:'c-rtax', target:'c-ubi',   type:'enables',       weight:0.75 },
        // Power pyramid
        { source:'c-cbdc', target:'fw-pow',  type:'instantiates',  weight:0.8  },
        { source:'c-prtb', target:'fw-pow',  type:'instantiates',  weight:0.9  },
        { source:'c-liq',  target:'fw-pow',  type:'instantiates',  weight:0.85 },
        { source:'c-algp', target:'fw-pow',  type:'addresses',     weight:0.9  },
        // LVN
        { source:'c-lvnx', target:'fw-lvn',  type:'instantiates',  weight:0.95 },
        { source:'c-care', target:'c-lvnx',  type:'part_of',       weight:0.95 },
        { source:'c-lval', target:'c-lvnx',  type:'part_of',       weight:0.9  },
        { source:'c-tbke', target:'c-lvnx',  type:'instantiates',  weight:0.8  },
        { source:'c-dtax', target:'c-lval',  type:'addresses',     weight:0.75 },
        { source:'c-ubi',  target:'c-lvnx',  type:'enables',       weight:0.85 },
        // Institutional evolution
        { source:'c-coop', target:'c-soec',  type:'evolved_from',  weight:0.85 },
        { source:'c-dao',  target:'c-coop',  type:'evolved_from',  weight:0.8  },
        { source:'c-plat', target:'c-coop',  type:'synthesizes',   weight:0.85 },
        { source:'c-plat', target:'c-soec',  type:'synthesizes',   weight:0.8  },
        { source:'c-dnut', target:'c-dgro',  type:'synthesizes',   weight:0.8  },
        // Critiques and tensions
        { source:'c-dgro', target:'c-rtax',  type:'conflicts_with',weight:0.65 },
        { source:'c-dtax', target:'c-lval',  type:'conflicts_with',weight:0.8  },
        // PRIME
        { source:'fw-prime',target:'c-ubi',  type:'embodies',      weight:0.85 },
        { source:'fw-prime',target:'c-rtax', type:'embodies',      weight:0.8  },
        // Framework inter-dependencies
        { source:'fw-l0',  target:'fw-pros', type:'enables',       weight:0.95 },
        { source:'fw-l0',  target:'fw-pow',  type:'enables',       weight:0.9  },
        { source:'fw-pros',target:'fw-pow',  type:'requires',      weight:0.85 },
        { source:'fw-lvn', target:'fw-pros', type:'addresses',     weight:0.85 },
        { source:'fw-prime',target:'fw-pros',type:'embodies',      weight:0.8  },
        { source:'fw-gato',target:'fw-pow',  type:'instantiates',  weight:0.85 },
      ]
    };

    // ─────────────────────────────────────────────
    // STATE — initialized from embedded data
    // ─────────────────────────────────────────────

    const state = {
      frameworks: STATIC.frameworks,
      concepts:   STATIC.concepts,
      tensions:   STATIC.tensions,
      evidence:   STATIC.evidence,
      sources:    STATIC.sources,
      loaded:     true
    };

    // ─────────────────────────────────────────────
    // API — optionally refreshes from Netlify DB
    // ─────────────────────────────────────────────

    async function tryApiRefresh() {
      // Only attempt on real HTTP origins (Netlify deployment), never on file:// or preview sandboxes
      // Only attempt on Netlify deployments — skip everywhere else (file://, preview sandboxes, localhost)
      const h = location.hostname;
      if (!h || h === 'localhost' || h === '127.0.0.1' || !location.href.startsWith('http')) return;
      if (!h.includes('.netlify.app') && !h.includes('.app') && !h.includes('.io') && !h.includes('.com')) return;
      try {
        const qs = new URLSearchParams({ resource: 'frameworks' }).toString();
        const res = await fetch(`/api/concepts?${qs}`, { signal: AbortSignal.timeout(3000) });
        if (!res.ok) return; // silently skip — static data already rendered
        const data = await res.json();
        if (data.frameworks && data.frameworks.length) {
          state.frameworks = data.frameworks;
          renderAll();
        }
      } catch { /* network unavailable — static data is sufficient */ }
    }

    // ─────────────────────────────────────────────
    // LOAD — render immediately from static, refresh from API if possible
    // ─────────────────────────────────────────────

    function loadAll() {
      renderAll();
      tryApiRefresh(); // fire-and-forget
    }

    function renderAll() {
      updateStats();
      renderNavSidebar();
      renderFwOverview();
    }

    function updateStats() {
      document.getElementById('stat-frameworks').textContent = state.frameworks.length;
      document.getElementById('stat-concepts').textContent = state.concepts.length;
      document.getElementById('stat-tensions').textContent = state.tensions.length;
      document.getElementById('stat-evidence').textContent = state.evidence.length;
    }

    // ─────────────────────────────────────────────
    // SIDEBAR NAVIGATION
    // ─────────────────────────────────────────────

    function renderNavSidebar() {
      // Frameworks
      const fwContainer = document.getElementById('nav-frameworks');
      document.getElementById('fw-count').textContent = state.frameworks.length;
      fwContainer.innerHTML = state.frameworks.map(fw => `
        <div class="nav-item" onclick="showFrameworkDetail('${fw.id}')">
          <div class="nav-item-dot" style="background:var(--hz)"></div>
          <div>
            <div class="nav-item-title">${fw.title}</div>
            <div class="nav-item-meta">${fw.code} · ${fw.scope}</div>
          </div>
        </div>
      `).join('');

      // Group concepts by type
      const typeGroups = {
        phenomena: state.concepts.filter(c => c.concept_type === 'phenomenon'),
        mechanisms: state.concepts.filter(c => c.concept_type === 'mechanism'),
        proposals: state.concepts.filter(c => c.concept_type === 'proposal'),
        critiques: [...state.concepts.filter(c => c.concept_type === 'critique'), ...state.concepts.filter(c => c.concept_type === 'synthesis')]
      };

      const colors = {
        phenomenon: '#7a2000', mechanism: 'var(--hz)', proposal: '#1d4f72',
        critique: '#7a4208', synthesis: '#2a5f53'
      };

      Object.entries({
        'nav-phenomena': typeGroups.phenomena,
        'nav-mechanisms': typeGroups.mechanisms,
        'nav-proposals': typeGroups.proposals,
        'nav-critiques': typeGroups.critiques
      }).forEach(([id, concepts]) => {
        const container = document.getElementById(id);
        if (container) {
          container.innerHTML = concepts.map(c => `
            <div class="nav-item" onclick="showConceptDetail('${c.id}')">
              <div class="nav-item-dot" style="background:${colors[c.concept_type] || 'var(--stn)'}"></div>
              <div>
                <div class="nav-item-title">${c.title}</div>
                <div class="nav-item-meta">${c.code}</div>
              </div>
            </div>
          `).join('');
        }
      });

      document.getElementById('phen-count').textContent = typeGroups.phenomena.length;
      document.getElementById('mech-count').textContent = typeGroups.mechanisms.length;
      document.getElementById('prop-count').textContent = typeGroups.proposals.length;
      document.getElementById('crit-count').textContent = typeGroups.critiques.length;

      // Tensions
      const tenContainer = document.getElementById('nav-tensions');
      document.getElementById('ten-count').textContent = state.tensions.length;
      tenContainer.innerHTML = state.tensions.map(t => `
        <div class="nav-item" onclick="showTensionDetail('${t.id}')">
          <div class="nav-item-dot" style="background:${t.severity === 'fundamental' ? '#a01010' : t.severity === 'significant' ? 'var(--dn)' : 'var(--stn)'}"></div>
          <div>
            <div class="nav-item-title">${t.title}</div>
            <div class="nav-item-meta">${t.tension_type} · ${t.severity}</div>
          </div>
        </div>
      `).join('');
    }

    function renderFwOverview() {
      const grid = document.getElementById('fw-overview-grid');
      grid.innerHTML = state.frameworks.map(fw => `
        <div class="fw-card" onclick="showFrameworkDetail('${fw.id}')">
          <div class="fw-card-code">${fw.code}</div>
          <div class="fw-card-title">${fw.title}</div>
          <div class="fw-card-desc">${fw.summary.slice(0, 120)}…</div>
          <div class="fw-card-footer">
            <span class="scope-badge scope-${fw.scope}">${fw.scope}</span>
            <span title="${fw.completeness}">
              <span class="completeness-dot comp-${fw.completeness}"></span>
              &nbsp;${fw.completeness}
            </span>
          </div>
        </div>
      `).join('');
    }

    // ─────────────────────────────────────────────
    // DETAIL VIEWS
    // ─────────────────────────────────────────────

    function showOverview() {
      document.getElementById('overview-panel').style.display = '';
      document.getElementById('detail-panel').classList.remove('visible');
    }

    function showDetail(html) {
      document.getElementById('overview-panel').style.display = 'none';
      const panel = document.getElementById('detail-panel');
      panel.classList.add('visible');
      document.getElementById('detail-content').innerHTML = html;
      window.lucide.createIcons();
    }

    function showFrameworkDetail(id) {
      const fw = state.frameworks.find(f => f.id === id);
      if (!fw) return;
      // Use embedded elements from static data — no API call needed
      const elements = fw.elements || [];
      const elementsHtml = renderFrameworkElements(fw, elements);
      showDetail(renderFrameworkShell(fw, elementsHtml));
    }

    function renderFrameworkShell(fw, elementsContent) {
      return `
        <div class="detail-header">
          <div class="detail-code">${fw.code}</div>
          <div class="detail-title">${fw.title}</div>
          <div class="detail-badges">
            <span class="detail-badge scope-${fw.scope}">${fw.scope}</span>
            <span class="detail-badge badge-mat-${fw.completeness}">${fw.completeness}</span>
            ${fw.layer_count ? `<span class="detail-badge" style="background:var(--pch);color:var(--stn)">${fw.layer_count} layers</span>` : ''}
          </div>
        </div>
        <div class="detail-summary">${fw.summary}</div>
        <div class="detail-section-title">Framework Elements <span style="margin-left:0.25rem;opacity:0.4">──────────────────────────────────</span></div>
        <div id="fw-elements-container">${elementsContent}</div>
      `;
    }

    function renderFrameworkElements(fw, elements) {
      if (!elements.length) return '<p style="color:var(--stn);font-size:0.8rem">No elements loaded yet.</p>';

      // Use pyramid for layered frameworks
      const isLayered = elements.some(e => e.layer_number);

      if (isLayered) {
        const sorted = [...elements].sort((a, b) => (b.layer_number || 0) - (a.layer_number || 0));
        return `<div class="pyramid-stack">${sorted.map(el => `
          <div class="pyramid-layer-card" style="margin-left:${((el.layer_number||1)-1)*8}px">
            <div class="pyramid-layer-num">${el.layer_number}</div>
            <div>
              <div class="pyramid-layer-title">${el.title}</div>
              <div class="pyramid-layer-role">${el.element_role || ''}</div>
              <div class="pyramid-layer-desc">${el.description || ''}</div>
            </div>
          </div>
        `).join('')}</div>`;
      }

      return `<div style="display:flex;flex-direction:column;gap:0.625rem">
        ${elements.map(el => `
          <div style="background:white;border:1px solid var(--mst);border-radius:0.5rem;padding:0.875rem">
            <div style="font-size:0.8rem;font-weight:600;color:var(--hz);margin-bottom:0.2rem">${el.title}</div>
            <div style="font-size:0.75rem;color:var(--stn);line-height:1.5">${el.description || ''}</div>
          </div>
        `).join('')}
      </div>`;
    }

    function showConceptDetail(id) {
      const c = state.concepts.find(x => x.id === id);
      if (!c) return;
      // Render with embedded data — relations/evidence come from static dataset
      const html = renderConceptShell(c);
      showDetail(html);
      // Extra section: no relations in static data, show placeholder gracefully
      document.getElementById('concept-detail-extra').innerHTML = renderConceptExtra([], [], []);
    }

    function renderConceptShell(c) {
      return `
        <div class="detail-header">
          <div class="detail-code">${c.code}</div>
          <div class="detail-title">${c.title}</div>
          <div class="detail-badges">
            <span class="detail-badge badge-type-${c.concept_type}">${c.concept_type}</span>
            <span class="detail-badge badge-mat-${c.maturity}">${c.maturity}</span>
            <span class="detail-badge badge-conf-${c.confidence}">${c.confidence}</span>
            <span class="detail-badge" style="background:var(--pch);color:var(--stn)">${c.domain}</span>
            ${c.is_core_ple ? '<span class="detail-badge" style="background:rgba(27,77,62,0.12);color:var(--hz)">Core PLE</span>' : ''}
          </div>
        </div>
        <div class="detail-summary">${c.summary}</div>
        ${c.origin_tradition ? `<div style="font-size:0.75rem;color:var(--stn);margin-bottom:1.5rem;display:flex;align-items:center;gap:0.5rem"><i data-lucide="book-open" style="width:13px;height:13px"></i> Intellectual tradition: <em>${c.origin_tradition}</em></div>` : ''}
        <div id="concept-detail-extra"><div class="loading-state"><div class="spinner"></div> Loading relationships…</div></div>
      `;
    }

    function renderConceptExtra(relations, evidence, tensions) {
      let html = '';

      if (relations.length) {
        html += `<div class="detail-section-title">Relationships</div>
        <div style="margin-bottom:1.5rem">${relations.map(r => `
          <div class="relation-row">
            <span class="rel-type-tag">${r.relation_type}</span>
            <div class="rel-target">
              <div class="rel-target-name">${r.target_id}</div>
              ${r.rel_desc ? `<div class="rel-target-desc">${r.rel_desc}</div>` : ''}
            </div>
          </div>
        `).join('')}</div>`;
      }

      if (tensions.length) {
        html += `<div class="detail-section-title">Documented Tensions</div>
        <div style="margin-bottom:1.5rem">${tensions.map(t => `
          <div class="tension-row">
            <div class="tension-title">${t.title}</div>
            <div class="tension-desc">${t.description}</div>
            <div class="tension-meta">
              <span class="tension-chip sev-${t.severity}">${t.severity}</span>
              <span class="tension-chip" style="background:var(--pch);color:var(--stn)">${t.tension_type}</span>
              <span class="tension-chip" style="background:var(--pch);color:var(--stn)">${t.resolution_status}</span>
            </div>
          </div>
        `).join('')}</div>`;
      }

      if (evidence.length) {
        html += `<div class="detail-section-title">Supporting Evidence</div>
        <div style="margin-bottom:1.5rem">${evidence.map(e => `
          <div class="evidence-row">
            <div class="evidence-quality-bar ev-q-${e.quality}"></div>
            <div class="ev-content">
              <div class="ev-title">${e.title} <span style="font-size:0.65rem;font-weight:400;color:var(--stn)">${e.link_type}</span></div>
              <div class="ev-desc">${e.description || ''}</div>
              <div class="ev-meta">
                <span class="ev-chip">${e.quality}</span>
                <span class="ev-chip">${e.evidence_type}</span>
                ${e.location ? `<span class="ev-chip">${e.location}</span>` : ''}
                ${e.time_period ? `<span class="ev-chip">${e.time_period}</span>` : ''}
              </div>
            </div>
          </div>
        `).join('')}</div>`;
      }

      if (!html) html = '<p style="color:var(--stn);font-size:0.8rem">No relationships documented yet.</p>';
      return html;
    }

    function showTensionDetail(id) {
      const t = state.tensions.find(x => x.id === id);
      if (!t) return;
      showDetail(`
        <div class="detail-header">
          <div class="detail-code">${t.code}</div>
          <div class="detail-title">${t.title}</div>
          <div class="detail-badges">
            <span class="tension-chip sev-${t.severity}">${t.severity}</span>
            <span class="detail-badge" style="background:var(--pch);color:var(--stn)">${t.tension_type}</span>
            <span class="detail-badge" style="background:var(--pch);color:var(--stn)">${t.resolution_status}</span>
          </div>
        </div>
        <div class="detail-summary">${t.description}</div>
        ${t.resolution_notes ? `
          <div class="detail-section-title">Resolution Notes</div>
          <p style="font-size:0.875rem;color:var(--mid2);line-height:1.7">${t.resolution_notes}</p>
        ` : `
          <div style="background:rgba(244,162,97,0.08);border:1px solid rgba(244,162,97,0.25);border-radius:0.625rem;padding:1rem 1.25rem;font-size:0.82rem;color:var(--stn)">
            ⚠️ This tension is currently <strong>${t.resolution_status}</strong>. 
            <a href="https://github.com/sillinous/PLEArchitecture/issues" target="_blank" style="color:var(--hz)">Contribute to resolution on GitHub →</a>
          </div>
        `}
      `);
    }

    function showTensions() {
      const html = `
        <div class="detail-header">
          <div class="detail-code">TENSIONS</div>
          <div class="detail-title">Documented Trade-offs</div>
        </div>
        <p style="color:var(--stn);font-size:0.875rem;line-height:1.7;margin-bottom:1.75rem">
          A theoretically honest framework acknowledges what it has not resolved. 
          These tensions are not bugs — they are known hard problems that PLE must navigate rather than pretend away.
        </p>
        ${state.tensions.map(t => `
          <div class="tension-row" style="cursor:pointer" onclick="showTensionDetail('${t.id}')">
            <div class="tension-title">${t.title}</div>
            <div class="tension-desc">${t.description.slice(0, 180)}…</div>
            <div class="tension-meta">
              <span class="tension-chip sev-${t.severity}">${t.severity}</span>
              <span class="tension-chip" style="background:var(--pch);color:var(--stn)">${t.tension_type}</span>
            </div>
          </div>
        `).join('')}
      `;
      showDetail(html);
    }

    function showEvidence() {
      const html = `
        <div class="detail-header">
          <div class="detail-code">EVIDENCE</div>
          <div class="detail-title">Empirical Anchors</div>
        </div>
        <p style="color:var(--stn);font-size:0.875rem;line-height:1.7;margin-bottom:1.75rem">
          Real-world experiments, case studies, and research that inform PLE theory. 
          Evidence quality is rated: consensus → meta-analysis → longitudinal → pilot → anecdotal.
        </p>
        ${state.evidence.map(e => `
          <div class="evidence-row" style="padding:1rem 0">
            <div class="evidence-quality-bar ev-q-${e.quality}" style="align-self:stretch"></div>
            <div class="ev-content">
              <div class="ev-title">${e.title}</div>
              <div class="ev-desc">${e.description}</div>
              <div class="ev-meta">
                <span class="ev-chip">${e.quality}</span>
                <span class="ev-chip">${e.evidence_type}</span>
                ${e.location ? `<span class="ev-chip">${e.location}</span>` : ''}
                ${e.time_period ? `<span class="ev-chip">${e.time_period}</span>` : ''}
              </div>
            </div>
          </div>
        `).join('')}
      `;
      showDetail(html);
    }

    function showFrameworks() { showOverview(); }

    function showConceptsBrowser(filter) {
      const concepts = filter === 'all' ? state.concepts : state.concepts.filter(c => c.concept_type === filter);
      const html = `
        <div class="detail-header">
          <div class="detail-code">CONCEPTS</div>
          <div class="detail-title">Conceptual Vocabulary</div>
        </div>
        <div class="filter-bar">
          ${['all','phenomenon','mechanism','proposal','critique','synthesis'].map(f => `
            <span class="filter-chip ${filter === f ? 'active' : ''}" onclick="showConceptsBrowser('${f}')">${f}</span>
          `).join('')}
        </div>
        <div class="concept-grid">
          ${concepts.map(c => `
            <div class="concept-card" onclick="showConceptDetail('${c.id}')">
              <div class="concept-card-code">${c.code}</div>
              <div class="concept-card-title">${c.title}</div>
              <div class="concept-card-tags">
                <span class="ctype-chip ct-${c.concept_type}">${c.concept_type}</span>
                <span class="domain-chip">${c.domain}</span>
                ${c.is_core_ple ? '<span class="ctype-chip ct-mechanism">core</span>' : ''}
              </div>
            </div>
          `).join('')}
        </div>
      `;
      showDetail(html);
    }



    // ─────────────────────────────────────────────
    // RELATIONSHIP GRAPH (D3 force-directed)
    // ─────────────────────────────────────────────

    const NODE_COLORS = {
      phenomenon: '#e07b4f',
      proposal:   '#1B4D3E',
      mechanism:  '#4a7c6f',
      synthesis:  '#5b4a8a',
      critique:   '#8b3a3a',
      framework:  '#F4A261',
    };

    const EDGE_COLORS = {
      enables:       '#2D6A54',
      requires:      '#4a7c6f',
      conflicts_with:'#c0392b',
      addresses:     '#457B9D',
      instantiates:  '#F4A261',
      part_of:       '#6C757D',
      evolved_from:  '#8b7355',
      synthesizes:   '#5b4a8a',
      challenges:    '#8b3a3a',
      embodies:      '#1B4D3E',
    };

    const EDGE_DASH = {
      requires:      '6,3',
      part_of:       '4,4',
      evolved_from:  '8,3',
      challenges:    '4,2',
      conflicts_with:'3,3',
    };

    let graphSim = null;
    let activeRelFilter = 'all';

    function buildGraphData(relFilter) {
      // Build nodes: all concepts + frameworks
      const nodeMap = {};

      state.concepts.forEach(c => {
        nodeMap[c.id] = {
          id:    c.id,
          label: c.title,
          code:  c.code,
          type:  c.concept_type,
          color: NODE_COLORS[c.concept_type] || '#6C757D',
          r:     c.is_core_ple ? 9 : 6,
          data:  c,
          kind:  'concept'
        };
      });

      state.frameworks.forEach(fw => {
        nodeMap[fw.id] = {
          id:    fw.id,
          label: fw.title,
          code:  fw.code,
          type:  'framework',
          color: NODE_COLORS.framework,
          r:     12,
          data:  fw,
          kind:  'framework'
        };
      });

      const rels = STATIC.relations || [];
      const filteredRels = relFilter === 'all' ? rels : rels.filter(r => r.type === relFilter);

      const usedIds = new Set();
      filteredRels.forEach(r => { usedIds.add(r.source); usedIds.add(r.target); });

      // Only show nodes that appear in filtered relations
      const nodes = Object.values(nodeMap).filter(n =>
        relFilter === 'all' || usedIds.has(n.id)
      );

      const edges = filteredRels
        .filter(r => nodeMap[r.source] && nodeMap[r.target])
        .map(r => ({
          source: r.source,
          target: r.target,
          type:   r.type,
          weight: r.weight || 0.7,
          color:  EDGE_COLORS[r.type] || '#6C757D',
          dash:   EDGE_DASH[r.type] || null,
        }));

      return { nodes, edges };
    }

    function showGraph() {
      // Hide other panels
      document.getElementById('overview-panel').style.display = 'none';
      document.getElementById('detail-panel').classList.remove('visible');
      document.getElementById('graph-panel').classList.add('visible');
      renderGraph(activeRelFilter);
    }

    function closeGraph() {
      document.getElementById('graph-panel').classList.remove('visible');
      document.getElementById('overview-panel').style.display = '';
    }

    function renderGraph(relFilter) {
      activeRelFilter = relFilter;
      const svg = d3.select('#graph-svg');
      svg.selectAll('*').remove();

      const svgEl = document.getElementById('graph-svg');
      const W = svgEl.clientWidth  || 900;
      const H = svgEl.clientHeight || 600;

      const { nodes, edges } = buildGraphData(relFilter);

      // Markers (arrowheads) per relation type
      const defs = svg.append('defs');
      const markerTypes = [...new Set(edges.map(e => e.type))];
      markerTypes.forEach(type => {
        const color = EDGE_COLORS[type] || '#6C757D';
        defs.append('marker')
          .attr('id', `arrow-${type}`)
          .attr('viewBox', '0 -5 10 10')
          .attr('refX', 22)
          .attr('refY', 0)
          .attr('markerWidth', 6)
          .attr('markerHeight', 6)
          .attr('orient', 'auto')
          .append('path')
          .attr('d', 'M0,-5L10,0L0,5')
          .attr('fill', color);
      });

      const g = svg.append('g');

      // Zoom
      svg.call(
        d3.zoom()
          .scaleExtent([0.2, 4])
          .on('zoom', e => g.attr('transform', e.transform))
      );

      // Edges
      const link = g.append('g').selectAll('line')
        .data(edges)
        .join('line')
        .attr('stroke', d => d.color)
        .attr('stroke-width', d => 1 + d.weight)
        .attr('stroke-opacity', 0.6)
        .attr('stroke-dasharray', d => d.dash || null)
        .attr('marker-end', d => `url(#arrow-${d.type})`);

      // Edge labels (show on hover via JS, hidden by default)
      const linkLabel = g.append('g').selectAll('text')
        .data(edges)
        .join('text')
        .attr('font-size', '8px')
        .attr('font-family', "'DM Mono', monospace")
        .attr('fill', d => d.color)
        .attr('opacity', 0)
        .attr('text-anchor', 'middle')
        .text(d => d.type.replace(/_/g, ' '));

      // Nodes
      const node = g.append('g').selectAll('g')
        .data(nodes, d => d.id)
        .join('g')
        .attr('cursor', 'pointer')
        .call(
          d3.drag()
            .on('start', (e, d) => { if (!e.active) sim.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
            .on('drag',  (e, d) => { d.fx = e.x; d.fy = e.y; })
            .on('end',   (e, d) => { if (!e.active) sim.alphaTarget(0); d.fx = null; d.fy = null; })
        )
        .on('click', (e, d) => {
          e.stopPropagation();
          if (d.kind === 'framework') showFrameworkDetail(d.id);
          else showConceptDetail(d.id);
          // Close graph, show detail
          document.getElementById('graph-panel').classList.remove('visible');
          document.getElementById('detail-panel').classList.add('visible');
        })
        .on('mouseover', (e, d) => {
          // Highlight connected edges
          link.attr('stroke-opacity', l =>
            l.source.id === d.id || l.target.id === d.id ? 1 : 0.08
          );
          linkLabel.attr('opacity', l =>
            l.source.id === d.id || l.target.id === d.id ? 1 : 0
          );
          node.attr('opacity', n => {
            if (n.id === d.id) return 1;
            const connected = edges.some(l =>
              (l.source.id === d.id && l.target.id === n.id) ||
              (l.target.id === d.id && l.source.id === n.id)
            );
            return connected ? 1 : 0.25;
          });
          // Tooltip
          const tt = document.getElementById('graph-tooltip');
          document.getElementById('tt-title').textContent = d.label;
          document.getElementById('tt-type').textContent  = d.type;
          tt.style.display = 'block';
          tt.style.left = (e.clientX + 12) + 'px';
          tt.style.top  = (e.clientY - 8) + 'px';
        })
        .on('mousemove', e => {
          document.getElementById('graph-tooltip').style.left = (e.clientX + 12) + 'px';
          document.getElementById('graph-tooltip').style.top  = (e.clientY - 8) + 'px';
        })
        .on('mouseout', () => {
          link.attr('stroke-opacity', 0.6);
          linkLabel.attr('opacity', 0);
          node.attr('opacity', 1);
          document.getElementById('graph-tooltip').style.display = 'none';
        });

      // Node circles (frameworks are rounded squares via clip)
      node.append('circle')
        .attr('r', d => d.r)
        .attr('fill', d => d.color)
        .attr('fill-opacity', d => d.kind === 'framework' ? 0.9 : 0.85)
        .attr('stroke', d => d.kind === 'framework' ? '#F4A261' : 'rgba(255,255,255,0.2)')
        .attr('stroke-width', d => d.kind === 'framework' ? 2 : 1);

      // Node labels
      node.append('text')
        .attr('dy', d => d.r + 11)
        .attr('text-anchor', 'middle')
        .attr('font-size', d => d.kind === 'framework' ? '9px' : '8px')
        .attr('font-family', "'DM Mono', monospace")
        .attr('font-weight', d => d.kind === 'framework' ? '600' : '400')
        .attr('fill', 'rgba(255,255,255,0.75)')
        .attr('pointer-events', 'none')
        .text(d => d.code);

      // Force simulation
      const sim = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(edges)
          .id(d => d.id)
          .distance(d => {
            const base = { enables:100, instantiates:80, part_of:60, requires:110, addresses:120, conflicts_with:130, synthesizes:90, evolved_from:95 };
            return (base[d.type] || 100) / (d.weight || 0.7);
          })
          .strength(0.4)
        )
        .force('charge', d3.forceManyBody().strength(-250).distanceMax(400))
        .force('center',  d3.forceCenter(W / 2, H / 2))
        .force('collide', d3.forceCollide().radius(d => d.r + 18))
        .on('tick', () => {
          link
            .attr('x1', d => d.source.x)
            .attr('y1', d => d.source.y)
            .attr('x2', d => d.target.x)
            .attr('y2', d => d.target.y);

          linkLabel
            .attr('x', d => (d.source.x + d.target.x) / 2)
            .attr('y', d => (d.source.y + d.target.y) / 2);

          node.attr('transform', d => `translate(${d.x},${d.y})`);
        });

      graphSim = sim;
    }

    // Filter buttons
    document.querySelectorAll('[data-rel-filter]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-rel-filter]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderGraph(btn.dataset.relFilter);
      });
    });

    // Dismiss tooltip on svg click
    document.getElementById('graph-svg').addEventListener('click', () => {
      document.getElementById('graph-tooltip').style.display = 'none';
    });

    // ─────────────────────────────────────────────
    // SIDEBAR TOGGLES
    // ─────────────────────────────────────────────

    document.querySelectorAll('.nav-section-header').forEach(header => {
      header.addEventListener('click', () => {
        const section = header.closest('.nav-section');
        section.classList.toggle('open');
      });
    });

    // ─────────────────────────────────────────────
    // SEARCH
    // ─────────────────────────────────────────────

    document.getElementById('nav-search-input').addEventListener('input', e => {
      const q = e.target.value.toLowerCase();
      document.querySelectorAll('.nav-item').forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = q === '' || text.includes(q) ? '' : 'none';
      });
    });

    // ─────────────────────────────────────────────
    // INIT
    // ─────────────────────────────────────────────

    window.lucide.createIcons();
    loadAll();
  </script>
</body>
</html>
